
- 웹의 Request /Response API 들을 이용하여 Custom Request handler를 생성
- App 디렉토리 내부에서만 사용가능

#### (1) GET Method

```typescript
export async function GET() {
  return new Response("Hello World");
}
```

#### (2) POST Method
```typescript

export async function POST(request: Request) {
  const comment = await request.json();
  const newComment = {
    id: comments.length + 1,
    text: comment.text,
  };
 ```

#### (3) PATCH Method
```typescript
//localhost:3000/comments/[id]
export async function PATCH(
  req: Request,
  { params }: { params: { id: string } }
) {
  const body = await req.json();
  const { text } = body;

  const index = comments.findIndex(
    (comment) => comment.id === parseInt(params.id)
  );
  comments[index].text = text;

  return Response.json(comments[index]);
}
```

#### (4) DELETE Method
```typescript

export async function DELETE(
  req: Request,
  { params }: { params: { id: string } }
) {
  const index = comments.findIndex(
    (comment) => comment.id === parseInt(params.id)
  );
  const deletedComment = comments[index];
  comments.splice(index, 1);
  return Response.json(deletedComment);
}
```
#### (5) Dynamic Route Handlers
```typescript
//app/comments/[id]/route.ts
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {

  if (parseInt(params.id) > comments.length){
    redirect("/comments");
  }

  const comment = comments.find(
    (comment) => comment.id === parseInt(params.id)
  );
  console.log(comment);
  return Response.json(comment);
}
```

#### (6) Query Parameters

```typescript
export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams;
  const query = searchParams.get("query");
  const filteredComments = query ? comments.filter(comment=> comment.text.includes(query)):comments;
  return Response.json(filteredComments);
}

```

#### (7) Headers & Cookies
```typescript
export async function GET(request: NextRequest) {
 
  //Header 가져오는 2가지 방법
  const requestHeaders = new Headers(request.headers);
  const headerList = headers();
  console.log(requestHeaders.get("Authorization"));
  console.log(headerList.get("Authorization"));

  //Cookie 가져오는 2가지 방법
  const theme = request.cookies.get("theme");
  cookies().set("resultsPerPage", "20");
  console.log(theme);
  console.log(cookies().get("resultsPerPage"));

  return new Response("<h1>Profile Route.ts</h1>", {
    headers: { "Content-Type": "text/html", "Set-Cookie": "theme=dark" },
  });
}
```

#### (8) Caching GET Method
- Route Handler는 GET메소드를 기본적으로 Caching하므로 캐싱을 끄려면 아래와 같이 강제로 리로드 해야한다.
```typescript
//GET방수의 Cache를 방지한다. 
export const dynamic = "force-dynamic";

export async function GET() {
  return Response.json({
    time: new Date().toLocaleTimeString()
  })
}

```


#### (9) Middleware
- 최종 END Point에 도달하기전에 중간에서 거쳐가는 미들웨어
```typescript
import { NextRequest, NextResponse } from "next/server";

export function middleware(request: NextRequest) {
  const response = NextResponse.next();

  //Custom Header를 넣는다.
  // response.headers.set("custom-header","custom-value");

  //   Cookie나 이런거 넣을수 있다.
  //   const themePreference = request.cookies.get("theme");
  //   if (!themePreference) {
  //     response.cookies.set("theme", "dark");
  //   }

  // if (request.nextUrl.pathname ==="/profile"){
  //아예 그 주소로 보냄
  // return NextResponse.redirect(new URL("/hello",request.url));l

  //주소는 그대로 렌더링만 리다이렉트
  // return NextResponse.rewrite(new URL("/hello",request.url));l
  // }
  // return NextResponse.redirect(new URL("/", request.url))
}

// export const config= {
//     matcher:"/profile",
// }

```