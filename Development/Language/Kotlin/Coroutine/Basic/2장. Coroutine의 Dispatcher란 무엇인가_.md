---
title: 2. Coroutine의 Dispatcher란 무엇인가?
date: 2022-11-11
type:  blog
author: harris baek
email: baekjh09@naver.com
---
tags: #kotlin, #language, #concurrent, #coroutine 

## 2.1 Dispatcher
코루틴을 시작하게 되면, Dispatcher란 단어를 가장 먼저 접하게 된다. 

Dispatch란 한국어로 '보내다'라는 뜻이다. 그렇다면 Dispatcher란 무엇을 보내는 것일까? 바로 스레드(Thread)에 코루틴(Coroutine)을 보낸다. 코루틴에서는 스레드 풀을 만들고 Dispatcher를 통해서 코루틴을 배분한다. 즉 코루틴을 만든 다음 해당 코루틴을 Dispatcher에 전송하면 Dispatcher은 자신이 관리하는 스레드풀 내의 스레드의 부하 상황에 맞춰 코루틴을 배분한다. 이를 시각적으로 표현하면 다음과 같다.


1. 유저가 코루틴을 생성한 후 Dispatcher에 전송한다.
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2Fc7YLRL%2FbtrcxH9VZ9d%2FZYwUOjv3Oa2lvWcqtEETJK%2Fimg.png)

2. Dispatcher는 자신이 잡고 있는 thread pool에서 자원이 남는 스레드가 어떤 스레드인지 확인한 후, 해당 스레드에 코루틴을 전송한다.
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FJLlcs%2Fbtrcs72rcMO%2FRL7ETLPINBfE5E59Fj5lv1%2Fimg.png)

3. 분배 받은 Thread는 해당 코루틴을 수행한다
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FIUBcH%2FbtrcxKeyme5%2FCjji0o4L37PlqL4AgCMDU0%2Fimg.png)


### 코루틴에서 스레드 풀 만들기
코루틴에서 스레드 풀을 만들기는 쉽다. 단수히 다음과 같은 코드를 수행하는 것만으로 스레드가 3개인 Dispatcher를 생성하는 것이 가능하다.
```kotlin
val dispatcher = newFixedThreadPoolContext(3, "ThreadPool")
val dispatcher = newSingleThreadContext("SingleThread")
```


###  코루틴에서 스레드 풀 만들지만 직접 스레드 풀을 제어하지 않느다.
 위 그림1~3 에서 볼 수 있듯이 코루틴은 만들어진 스레드 풀을 직접 제어하지 않고 Dispatcher을 통해 제어한다. 즉, 스레드 풀을 직접 만들 수 있지만, 해당 스레드 풀 제어는 모두 Dispatcher에게 맡긴다. **우리가 Dispatcher에 코루틴을 보내기만 하면, Dispatcher은 스레드에 코루틴을 분산시킨다.**


### 안드로이드의 Dispacher
-  **Dispatchers.Main** - Android 메인 스레드에서 코루틴을 실행하는 디스패처. 이 디스패처는 UI와 상호작용하는 작업을 실행하기 위해서만 사용해야 한다.
-  **Dispatchers.IO** - 디스크 또는 네트워크 I/O 작업을 실행하는데 최적화되어 있는 디스패처. 
-  **Dispatchers.Default** - CPU를 많이 사용하는 작업을 기본 스레드 외부에서 실행하도록 최적화되어 있는 디스패처. 정렬 작업이나 JSON 파싱 작업 등에 최적화 되어 있다.

```kotlin
CoroutineScope(Dispatchers.Main).launch{
	updateButton() //필요한 job 수행
}
```

